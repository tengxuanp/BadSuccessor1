name: Build BadSuccessor (Desktop)

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-2025

    steps:
      # 1. Checkout the repository
      - name: Checkout repository
        uses: actions/checkout@v3
        
      - name: Install .NET Framework 4.6.1 Developer Pack
        run: |
          Invoke-WebRequest -Uri https://aka.ms/vs/17/release/vs_Enterprise.exe -OutFile vs_installer.exe
          Start-Process -FilePath vs_installer.exe -ArgumentList '--add Microsoft.Net.Component.4.6.1.TargetingPack --quiet --wait' -Wait
          
      # 2. Setup MSBuild
      - name: Setup MSBuild
        uses: microsoft/setup-msbuild@v1.3.1

      # 3. Optional: Set environment variables for .NET Framework 4.8
      - name: Set .NET Framework environment
        run: |
          $env:FrameworkDir = "C:\Windows\Microsoft.NET\Framework64"
          $env:FrameworkVersion = "v4.0.30319"

      # 4. Restore NuGet packages
      - name: Restore NuGet packages
        run: nuget restore BadSuccessor.sln

      # 5. Build the solution in Release mode targeting Any CPU
      - name: Build solution
        run: msbuild BadSuccessor.sln /p:Configuration=Release /p:Platform="Any CPU"

      # 6. Upload the compiled executable as an artifact
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: BadSuccessor-exe
          path: BadSuccessor/bin/Release/BadSuccessor.exe
